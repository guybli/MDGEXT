/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.DateTime");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.GLAccount");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.GLAccountCreate");jQuery.sap.require("fcg.mdg.approvecrv2.util.Formatter");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.GLAccCompCodeDetail",{compCode:"",oCompCodeDetails:"",bindingContext:"",sPath:"",oS3Instance:"",extHooknavtoDetail:null,extHookModifyStyleClass:null,extHookWithhldTable:null,extHookDunningTable:null,extHookdisplayCompCodedata:null,changerequestId:"",oGlCompCodeDetails:"",i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),onInit:function(){this.getView().byId("glCompCodePage").setShowNavButton(true);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="GLCompanyCode"){var c=e.getParameter('arguments').GLAccComp;var s=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.getS3Instance();var d=s.getDecisions();s.createDecisionButtons(d,this,'navFromDetail');if(c!==""){var g="";var G=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oCCData.ACCOUNT.ACCOUNT2ACCCCDETRel;for(var i=0;i<G.results.length;i++){if(G.results[i].COMPCODE===c)g=G.results[i];}}if(s.oGlAccountCompForm){s.oGlAccountCompForm.destroy();}if(s.oGlAccountCompForm===""){s.oGlAccountCompForm=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.GLAccCompCodeDetails',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("glCompCodePage").removeContent(s.oGlAccountCompForm);s.oGlAccountCompForm=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.GLAccCompCodeDetails',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("glCompCodePage").addContent(s.oGlAccountCompForm);this.displayData(g);var a=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction;if(a==="CHANGE"){fcg.mdg.approvecrv2.DomainSpecParts.GLAccountChange.setBoldCCData(g);}}},this);},PressBack:function(){if(this.oGlCompCodeDetails){this.oGlCompCodeDetails.destroy();}},onExit:function(){if(this.oGlCompCodeDetails){this.oGlCompCodeDetails.destroy();}},displayData:function(r){this.setHeader(r);if(r.ACCICFREQ==="00"){r.ACCICFREQ="";}var c=new sap.ui.model.json.JSONModel();c.setData(r);sap.ui.getCore().byId("glCCControlData").setModel(c);sap.ui.getCore().byId("TXT_COMPCODE").setVisible(false);var C=r.ACCCCDET2AtthACCCCDETRel;if(C!==undefined){if(C.results.length>0){var v=false;var a=false;var d=false;var D={results:[]};if(r.ChangeData!==undefined&&fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'){for(var i=0;i<r.ChangeData.results.length;i++){if(r.ChangeData.results[i].EntityAction!=='C')v=true;break;}if(v){for(var i=0;i<C.results.length;i++){D.results[i]=false;if(C.results[i].ChangeData.length!==0||C.results[i].ChangeData!==undefined){for(var j=0;j<C.results[i].ChangeData.results.length;j++){a=false;v=false;if(C.results[i].ChangeData.results[j].EntityAction==='C')v=true;else if(C.results[i].ChangeData.results[j].EntityAction==='D')a=true;var r=C.results[i];this.getglCCAttachmentList_2(r,v,a);D.results[i]=true;d=true;}if(!D.results[i]){var r=C.results[i];this.getglCCAttachmentList_2(r,false,false);}}}}}if(!d)this.getglCCAttachmentList(C,v,a);}else sap.ui.getCore().byId('glCCAttach').destroy();}else sap.ui.getCore().byId('glCCAttach').destroy();fcg.mdg.approvecrv2.DomainSpecParts.GLAccountCreate.hidesectionCC();},setHeader:function(r){var c=r.COMPCODE__TXT+"("+r.COMPCODE+")";var g=this.getView().byId("glObjHeaderDet");g.setTitle(c);var a=fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();this.getView().byId("glCOA").setText(a);var e=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oCCData.Edition;var b=fcg.mdg.approvecrv2.util.Formatter.validityFormatter(e.UsmdVdateFrom,e.UsmdVdateTo);this.getView().byId("glVal").setText(b);},getglCCAttachmentList:function(r,v,a){var o=sap.ui.getCore().byId("glCCAttach");var c=new sap.m.CustomListItem({});var C;var l;for(var i=0;i<r.results.length;i++){var L="";if(r.results[i].USMD_LINK!==""){L=r.results[i].USMD_LINK;}else L=r.results[i].__metadata.media_src;var f=fcg.mdg.approvecrv2.util.Formatter.dateFormatter(r.results[i].USMD_ACREATED_AT)+" "+this.i18n.getText('AttachBy')+" ";var b=" "+r.results[i].USMD_ACREATED_BY__TXT+"("+r.results[i].USMD_ACREATED_BY+")";if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'&&r.results[i].ChangeData.results.length!==0&&v){C=new sap.m.Text({text:f+" "+b}).addStyleClass("text_bold");l=true;}else{C=new sap.m.Text({text:f+" "+b});l=false;}var A=new sap.m.Link({text:r.results[i].USMD_TITLE,target:"_blank",href:L,wrapping:true,subtle:false,emphasized:l}).addStyleClass("padding_bottom");if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'&&r.results[i].ChangeData!==undefined&&r.results[i].ChangeData.results.length!==0){for(var j=0;j<r.results[i].ChangeData.results.length;j++){if(r.results[i].ChangeData.results[j].EntityAction==='D'){C.addStyleClass('sapThemeText').addStyleClass('text_bold');A.setHref("");A.addStyleClass('sapThemeText').addStyleClass('text_bold');}}}var d=new sap.m.VBox({items:[A,C]}).addStyleClass("padding_left");var I=fcg.mdg.approvecrv2.util.Formatter.mimeTypeFormatter(r.results[i].USMD_FILE_TYPE);I=new sap.ui.core.Icon({src:I,size:"3.0em"});var h=new sap.m.HBox({items:[I,d]}).addStyleClass("Hbox_padding");c.addContent(h);o.addItem(c);}if(o.getItems().length===0){sap.ui.getCore().byId("glCCAttach").destroy();}},getglCCAttachmentList_2:function(r,v,a){var o=sap.ui.getCore().byId("glCCAttach");var c=new sap.m.CustomListItem({});var C;var l;var L="";if(r.USMD_LINK!==""){L=r.USMD_LINK;}else L=r.__metadata.media_src;var f=fcg.mdg.approvecrv2.util.Formatter.dateFormatter(r.USMD_ACREATED_AT)+" "+this.i18n.getText('AttachBy')+" ";var b=" "+r.USMD_ACREATED_BY__TXT+"("+r.USMD_ACREATED_BY+")";if(a){C=new sap.m.Text({text:f+" "+b}).addStyleClass("sapThemeText");l=true;}else if(v){C=new sap.m.Text({text:f+" "+b}).addStyleClass("text_bold");l=true;}else{C=new sap.m.Text({text:f+" "+b});l=false;}var A=new sap.m.Link({text:r.USMD_TITLE,target:"_blank",href:L,wrapping:true,subtle:false,emphasized:l}).addStyleClass("padding_bottom");if(a){A.setHref("");A.addStyleClass("sapThemeText");}var d=new sap.m.VBox({items:[A,C]}).addStyleClass("padding_left");var i=fcg.mdg.approvecrv2.util.Formatter.mimeTypeFormatter(r.USMD_FILE_TYPE);i=new sap.ui.core.Icon({src:i,size:"3.0em"});var h=new sap.m.HBox({items:[i,d]}).addStyleClass("Hbox_padding");c.addContent(h);o.addItem(c);if(o.getItems().length===0){sap.ui.getCore().byId("glCCAttach").destroy();}}});
