/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.DateTime");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.GLAccount");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.GLAccountCreate");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.GLAccCostElDetail",{compCode:"",oItemTemp:"",oCompCodeDetails:"",bindingContext:"",sPath:"",oS3Instance:"",extHooknavtoDetail:null,extHookModifyStyleClass:null,extHookWithhldTable:null,extHookDunningTable:null,extHookdisplayCompCodedata:null,changerequestId:"",oGlCostElDetails:"",extHookglHookgetCEDescTemplate:null,i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),onInit:function(){this.getView().byId("glCostElPage").setShowNavButton(true);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="GLCostEl"){var c=e.getParameter('arguments').GLAccCOA;var s=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.getS3Instance();var d=s.getDecisions();s.createDecisionButtons(d,this,'navFromDetail');if(c!==""){var g="";var G=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oCEData.ACCOUNT.ACCOUNT2CELEMRel;for(var i=0;i<G.results.length;i++){if(G.results[i].COAREA===c||c.indexOf(G.results[i].COAREA)>-1){g=G.results[i];}}}if(s.oGlAccountCelemForm===""){s.oGlAccountCelemForm=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.GLAccCostElDetails',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("glCostElPage").removeContent(s.oGlAccountCelemForm);if(s.oGlAccountCelemForm!==undefined){s.oGlAccountCelemForm.destroy();}s.oGlAccountCelemForm=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.GLAccCostElDetails',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("glCostElPage").addContent(s.oGlAccountCelemForm);}if(g!==undefined){this.displaydata(g,s);var a=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction;if(a==="CHANGE"){fcg.mdg.approvecrv2.DomainSpecParts.GLAccountChange.setBoldCEData(g);}}},this);},displaydata:function(r,s){this.setHeader(r);var c=new sap.ui.model.json.JSONModel();c.setData(r);sap.ui.getCore().byId("glCEDetails").setModel(c);var C=r.CELEM2AtthCELEMRel;if(!s.oApplicationFacade.isMock()){var a;if(fcg.mdg.approvecrv2.util.Formatter.removeLeadingZeros(r.CELEM2ACCOUNTRel.ACCOUNT)===fcg.mdg.approvecrv2.util.Formatter.removeLeadingZeros(r.CELEM)){a=this.i18n.getText("GL_TXT_CLAS");}else{a=this.i18n.getText("GL_TXT_CLAS_SEC");}sap.ui.getCore().byId("TXT_DET_CLASSIFICATION").setText(a);}if(r.CELEM2DTxtCELEMRel.results.length>0){var t=sap.ui.getCore().byId("glCostElDescTab");this.setStyleForCELEMTable(r,t);}else{sap.ui.getCore().byId('glCostElTab').destroy();}if(C!==undefined){if(C.results.length>0){var v=false;var b=false;var d=false;var D={results:[]};if(r.ChangeData!==undefined&&fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'){for(var i=0;i<r.ChangeData.results.length;i++){if(r.ChangeData.results[i].EntityAction!=='C')v=true;break;}if(v){for(var i=0;i<C.results.length;i++){D.results[i]=false;if(C.results[i].ChangeData.length!==0||C.results[i].ChangeData!==undefined){for(var j=0;j<C.results[i].ChangeData.results.length;j++){b=false;v=false;if(C.results[i].ChangeData.results[j].EntityAction==='C')v=true;else if(C.results[i].ChangeData.results[j].EntityAction==='D')b=true;var r=C.results[i];this.getglCEAttachmentList_2(r,v,b);D.results[i]=true;d=true;}if(!D.results[i]){var r=C.results[i];this.getglCEAttachmentList_2(r,false,false);d=true;}}}}}if(!d)this.getglCEAttachmentList(C,v,b);}else sap.ui.getCore().byId('glCostElAttach').destroy();}else sap.ui.getCore().byId('glCostElAttach').destroy();fcg.mdg.approvecrv2.DomainSpecParts.GLAccountCreate.hideCEsection();},setStyleForCELEMTable:function(r,t){var m=new sap.ui.model.json.JSONModel();var v=false;m.setData(r.CELEM2DTxtCELEMRel);t.setVisible(true);t.setModel(m);for(var j=0;j<r.CELEM2DTxtCELEMRel.results.length;j++){if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'&&r.CELEM2DTxtCELEMRel.results[j].ChangeData!==undefined){for(var k=0;k<r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length;k++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData.results[k].EntityAction==='D'){v=true;}break;}break;}}var i=this.getCEDescTemplate(m,r,v);t.bindItems("/results",i);},getCEDescTemplate:function(m,r,v){var I=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"LANGU__TXT",formatter:function(){var d=m.getProperty("LANGU__TXT",this.getBindingContext());var a=false;if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction=='CHANGE'){if(v){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LANGU");a=true;}else{if(r.ChangeData!==undefined&&r.ChangeData.results.length!==0){for(var i=0;i<r.ChangeData.results.length;i++){if(r.ChangeData.results[i].EntityAction!=="C"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LANGU");a=true;}break;}}}if(!a){if(r.CELEM2DTxtCELEMRel!==undefined&&r.CELEM2DTxtCELEMRel.results.length!==0){for(var j=0;j<r.CELEM2DTxtCELEMRel.results.length;j++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData!==undefined&&r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length!==0){for(var k=0;k<r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length;k++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData.results[k].EntityAction==='D'){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LANGU");}}}}}}}return fcg.mdg.approvecrv2.util.Formatter.noValue(d);}}}),new sap.m.Text({text:{path:"TXTSH",formatter:function(){var d=false;if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction=='CHANGE'){if(v){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTSH");d=true;}else{if(r.ChangeData!==undefined&&r.ChangeData.results.length!==0){for(var i=0;i<r.ChangeData.results.length;i++){if(r.ChangeData.results[i].EntityAction!=="C"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTSH");d=true;}break;}}}if(!d){if(r.CELEM2DTxtCELEMRel!==undefined&&r.CELEM2DTxtCELEMRel.results.length!==0){for(var j=0;j<r.CELEM2DTxtCELEMRel.results.length;j++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData!==undefined&&r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length!==0){for(var k=0;k<r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length;k++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData.results[k].EntityAction==='D'){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTSH");}}}}}}}return fcg.mdg.approvecrv2.util.Formatter.noValue(m.getProperty('TXTSH',this.getBindingContext()));}}}),new sap.m.Text({text:{path:"TXTMI",formatter:function(){var d=false;if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction=='CHANGE'){if(v){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTMI");d=true;}else{if(r.ChangeData!==undefined&&r.ChangeData.results.length!==0){for(var i=0;i<r.ChangeData.results.length;i++){if(r.ChangeData.results[i].EntityAction!=="C"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTMI");d=true;}break;}}}if(!d){if(r.CELEM2DTxtCELEMRel!==undefined&&r.CELEM2DTxtCELEMRel.results.length!==0){for(var j=0;j<r.CELEM2DTxtCELEMRel.results.length;j++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData!==undefined&&r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length!==0){for(var k=0;k<r.CELEM2DTxtCELEMRel.results[j].ChangeData.results.length;k++){if(r.CELEM2DTxtCELEMRel.results[j].ChangeData.results[k].EntityAction==='D'){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTMI");}}}}}}}return fcg.mdg.approvecrv2.util.Formatter.noValue(m.getProperty('TXTMI',this.getBindingContext()));}}})]});if(this.extHookglHookgetCEDescTemplate){var e=this.extHookglHookgetCEDescTemplate(I);I=e;}return I;},setHeader:function(r){var c=r.CELEM__TXT+"("+r.COAREA+"/"+fcg.mdg.approvecrv2.util.Formatter.removeLeadingZeros(r.CELEM)+")";var g=this.getView().byId("glCEObjHeaderDet");g.setTitle(c);var a=fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();this.getView().byId("glCE").setText(a);var e=fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oCEData.Edition;var b=fcg.mdg.approvecrv2.util.Formatter.validityFormatter(e.UsmdVdateFrom,e.UsmdVdateTo);this.getView().byId("glVal").setText(b);},getglCEAttachmentList:function(r,v,a){var o=sap.ui.getCore().byId("glCostElAttach");var c=new sap.m.CustomListItem({});var C;var l;for(var i=0;i<r.results.length;i++){var L="";if(r.results[i].USMD_LINK!==""){L=r.results[i].USMD_LINK;}else L=r.results[i].__metadata.media_src;var f=fcg.mdg.approvecrv2.util.Formatter.dateFormatter(r.results[i].USMD_ACREATED_AT)+" "+this.i18n.getText('AttachBy')+" ";var b=" "+r.results[i].USMD_ACREATED_BY__TXT+"("+r.results[i].USMD_ACREATED_BY+")";if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'&&r.results[i].ChangeData.results.length!==0&&v){C=new sap.m.Text({text:f+" "+b}).addStyleClass("text_bold");l=true;}else{C=new sap.m.Text({text:f+" "+b});l=false;}var A=new sap.m.Link({text:r.results[i].USMD_TITLE,target:"_blank",href:L,wrapping:true,subtle:false,emphasized:l}).addStyleClass("padding_bottom");if(fcg.mdg.approvecrv2.DomainSpecParts.GLAccount.oVAction==='CHANGE'&&r.results[i].ChangeData!==undefined&&r.results[i].ChangeData.results.length!==0){for(var j=0;j<r.results[i].ChangeData.results.length;j++){if(r.results[i].ChangeData.results[j].EntityAction==='D'){C.addStyleClass('sapThemeText').addStyleClass('text_bold');A.setHref("");A.addStyleClass('sapThemeText').addStyleClass('text_bold');}}}var d=new sap.m.VBox({items:[A,C]}).addStyleClass("padding_left");var I=fcg.mdg.approvecrv2.util.Formatter.mimeTypeFormatter(r.results[i].USMD_FILE_TYPE);I=new sap.ui.core.Icon({src:I,size:"3.0em"});var h=new sap.m.HBox({items:[I,d]}).addStyleClass("Hbox_padding");c.addContent(h);o.addItem(c);}if(o.getItems().length===0){sap.ui.getCore().byId("glCostElAttach").destroy();}},getglCEAttachmentList_2:function(r,v,a){var o=sap.ui.getCore().byId("glCostElAttach");var c=new sap.m.CustomListItem({});var C;var l;var L="";if(r.USMD_LINK!==""){L=r.USMD_LINK;}else L=r.__metadata.media_src;var f=fcg.mdg.approvecrv2.util.Formatter.dateFormatter(r.USMD_ACREATED_AT)+" "+this.i18n.getText('AttachBy')+" ";var b=" "+r.USMD_ACREATED_BY__TXT+"("+r.USMD_ACREATED_BY+")";if(a){C=new sap.m.Text({text:f+" "+b}).addStyleClass("sapThemeText");l=true;}else if(v){C=new sap.m.Text({text:f+" "+b}).addStyleClass("text_bold");l=true;}else{C=new sap.m.Text({text:f+" "+b});l=false;}var A=new sap.m.Link({text:r.USMD_TITLE,target:"_blank",href:L,wrapping:true,subtle:false,emphasized:l}).addStyleClass("padding_bottom");if(a){A.setHref("");A.addStyleClass("sapThemeText");}var d=new sap.m.VBox({items:[A,C]}).addStyleClass("padding_left");var i=fcg.mdg.approvecrv2.util.Formatter.mimeTypeFormatter(r.USMD_FILE_TYPE);i=new sap.ui.core.Icon({src:i,size:"3.0em"});var h=new sap.m.HBox({items:[i,d]}).addStyleClass("Hbox_padding");c.addContent(h);o.addItem(c);if(o.getItems().length===0){sap.ui.getCore().byId("glCostElAttach").destroy();}}});
