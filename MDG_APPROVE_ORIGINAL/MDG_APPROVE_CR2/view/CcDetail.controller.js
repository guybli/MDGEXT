/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.CostCenterCreate");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.CostCenterChange");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.CostCenter");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.CcDetail",{aDetailData:"",commHeaderIndex:"",oAddTitle:"",oCostCenterDetails:"",extHookModifyDetailFormData:null,extHookDetailDescTemplate:null,extHookHideDetailAddressSection:null,extHookHideDetailCommSection:null,extHookModifyStyleClass:null,extHookDetDescriptionTable:null,i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);this.getView().byId("ccDetail").setShowNavButton(true);this.oDataManager=sap.ca.scfld.md.app.Application.getImpl().getComponent().getDataManager();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="ccItemDetail"){if(this.oCostCenterDetails===""){this.oCostCenterDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.CostCenterDetailsForm',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("ccDetail").removeContent(this.oCostCenterDetails);if(this.oCostCenterDetails!==undefined){this.oCostCenterDetails.destroy();}this.oCostCenterDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.CostCenterDetailsForm',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("ccDetail").addContent(this.oCostCenterDetails);var d="";d=fcg.mdg.approvecrv2.DomainSpecParts.CostCenterChange.getDetailData();var s=fcg.mdg.approvecrv2.DomainSpecParts.CostCenter.getS3Instance();var D=s.getDecisions();s.createDecisionButtons(D,this,'navFromDetail');if(this.extHookModifyDetailFormData){var a=this.extHookModifyDetailFormData(d);if(a!==undefined){d=a;}}var o=new sap.ui.model.json.JSONModel();o.setData(d);sap.ui.getCore().byId("ccDetailSimpleForm").setModel(o);this.getView().byId("ccObjHeaderDet").setModel(o);this.getView().byId("ccObjHeaderDet").setTitle(d.CCTR.TXTSH+"("+d.CCTR.COAREA+"/"+d.CCTR.CCTR+")");this.getView().byId("ccDetail").setTitle(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText("CC_ID"));var S="text_bold";if(this.extHookModifyStyleClass){var n=this.extHookModifyStyleClass(S);if(n!==undefined){S=n;}}var t=sap.ui.getCore().byId("CcDetailDescriptionTable");if(d.CCTR.CCTR2DTxtCCTRRel.results.length>0){if(this.extHookDetDescriptionTable){this.extHookDetDescriptionTable(d,t);}else{var m=new sap.ui.model.json.JSONModel();m.setData(d.CCTR.CCTR2DTxtCCTRRel);for(var i=0;i<m.oData.results.length;i++){if(m.oData.results[i].ChangeData!==undefined){for(var j=0;j<m.oData.results[i].ChangeData.results.length;j++){if(m.oData.results[i].ChangeData.results[j].EntityAction==='D')m.oData.results[i].ChangeData.results[j].Attribute="";}}}t.setVisible(true);t.setModel(m);var I=this.getDescTemplate(m);t.bindItems("/results",I);}}else{this.hideTable();}for(var i=0;i<d.CCTR.ChangeData.results.length;i++){var l="LBL_CCDET_"+d.CCTR.ChangeData.results[i].Attribute;var L=sap.ui.getCore().byId(l);if(L!==undefined){L.setDesign("Bold");}var T="DET_"+d.CCTR.ChangeData.results[i].Attribute;if(sap.ui.getCore().byId(T)!==undefined){sap.ui.getCore().byId(T).addStyleClass(S);}}this.hideSection();this.createCcDetAttachmentList(d);}},this);},getDescTemplate:function(m){var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"CD_LANGU/Description",formatter:function(){var d=m.getProperty("CD_LANGU/Description",this.getBindingContext());var k=m.getProperty("CD_LANGU/Code",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LANGU");return fcg.mdg.approvecrv2.util.Formatter.noValue(fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d));}}}),new sap.m.Text({text:{path:"TXTSH",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTSH");return fcg.mdg.approvecrv2.util.Formatter.noValue(m.getProperty('TXTSH',this.getBindingContext()));}}}),new sap.m.Text({text:{path:"TXTMI",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTMI");return fcg.mdg.approvecrv2.util.Formatter.noValue(m.getProperty('TXTMI',this.getBindingContext()));}}})]});return i;},hideSection:function(){if(this.extHookHideDetailAddressSection){this.extHookHideDetailAddressSection();}else{if(sap.ui.getCore().byId("DET_CC_STRAS").getText()===""&&sap.ui.getCore().byId("DET_CC_PSTLZ").getText()===""&&sap.ui.getCore().byId("DET_CC_ORT01").getText()===""&&sap.ui.getCore().byId("DET_CC_ORT02").getText()===""&&sap.ui.getCore().byId("DET_CC_LAND1").getText()===""&&sap.ui.getCore().byId("DET_CC_REGION").getText()===""&&sap.ui.getCore().byId("DET_CC_PSTL2").getText()===""&&sap.ui.getCore().byId("DET_CCTRTXJCD").getText()===""&&sap.ui.getCore().byId("DET_CC_ANRED").getText()===""&&sap.ui.getCore().byId("DET_CC_NAME1").getText()===""&&sap.ui.getCore().byId("DET_CC_NAME2").getText()===""&&sap.ui.getCore().byId("DET_CC_NAME3").getText()===""&&sap.ui.getCore().byId("DET_CC_NAME4").getText()===""&&sap.ui.getCore().byId("AddressTitle")!==undefined){sap.ui.getCore().byId("AddressTitle").destroy();}}if(this.extHookHideDetailCommSection){this.extHookHideDetailCommSection();}else{if(sap.ui.getCore().byId("DET_CC_SPRAS").getText()===""&&sap.ui.getCore().byId("DET_CC_TELF1").getText()===""&&sap.ui.getCore().byId("DET_CC_TELF2").getText()===""&&sap.ui.getCore().byId("DET_CC_TELFX").getText()===""&&sap.ui.getCore().byId("DET_CC_TELTX").getText()===""&&sap.ui.getCore().byId("DET_CC_TELX1").getText()===""&&sap.ui.getCore().byId("DET_CC_TELBX").getText()===""&&sap.ui.getCore().byId("DET_CC_DRNAM").getText()===""&&sap.ui.getCore().byId("DET_CC_DATLT").getText()===""&&sap.ui.getCore().byId("CommunicationTitle")!==undefined){sap.ui.getCore().byId("CommunicationTitle").destroy();}}if(sap.ui.getCore().byId("DET_CCTRQTYRQ").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKAPP").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKASC").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKPPC").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKPSC").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKARP").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKPRV").getText()===""&&sap.ui.getCore().byId("DET_CCTRLKCUP").getText()===""&&sap.ui.getCore().byId("IndicatorsTitle")!==undefined){sap.ui.getCore().byId("IndicatorsTitle").destroy();}},hideTable:function(){sap.ui.getCore().byId("CcDetailDescriptionTable").setVisible(false);},validityFormatter:function(v,V){var f="";var t="";if(v===""||v===null||v===undefined||V===""||V===null||V===undefined)return"";if(v){f=sap.ca.ui.model.format.DateFormat.getDateInstance().format(v);}if(V){t=sap.ca.ui.model.format.DateFormat.getDateInstance().format(V);}return sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText("Validity")+": "+f+" - "+t;},createCcDetAttachmentList:function(r){var a=sap.ui.getCore().byId("ccAttachFileUpload");var c=new sap.m.CustomListItem({});var C="";var l="";for(var i=0;i<r.CCTR.CCTR2AtthCCTRRel.results.length;i++){var L="";if(r.CCTR.CCTR2AtthCCTRRel.results[i].USMD_LINK!=="")L=r.CCTR.CCTR2AtthCCTRRel.results[i].USMD_LINK;else L=r.CCTR.CCTR2AtthCCTRRel.results[i].__metadata.media_src;var f=fcg.mdg.approvecrv2.util.Formatter.dateFormatter(r.CCTR.CCTR2AtthCCTRRel.results[i].USMD_ACREATED_AT)+" "+this.i18n.getText('AttachBy')+" ";var v=" "+r.CCTR.CCTR2AtthCCTRRel.results[i].CD_USMD_ACREATED_BY.Description+"("+r.CCTR.CCTR2AtthCCTRRel.results[i].CD_USMD_ACREATED_BY.Code+")";var b="";for(var j=0;j<r.CCTR.CCTR2AtthCCTRRel.results[i].ChangeData.results.length;j++){b=f+" "+v;break;}if(b!==""){C=new sap.m.Text({text:f+" "+v}).addStyleClass("text_bold");l=true;for(var j=0;j<r.CCTR.CCTR2AtthCCTRRel.results[i].ChangeData.results.length;j++){if(r.CCTR.CCTR2AtthCCTRRel.results[i].ChangeData.results[j].EntityAction==='D')C.addStyleClass('sapThemeText');}}else{C=new sap.m.Text({text:f+" "+v});l=false;}var A=new sap.m.Link({text:r.CCTR.CCTR2AtthCCTRRel.results[i].USMD_TITLE,target:"_blank",href:L,wrapping:true,subtle:false,emphasized:l}).addStyleClass("padding_bottom");for(var j=0;j<r.CCTR.CCTR2AtthCCTRRel.results[i].ChangeData.results.length;j++){if(r.CCTR.CCTR2AtthCCTRRel.results[i].ChangeData.results[j].EntityAction==='D'){A.setHref("");A.addStyleClass('sapThemeText');}}var d=new sap.m.VBox({items:[A,C]}).addStyleClass("padding_left");var I=fcg.mdg.approvecrv2.util.Formatter.mimeTypeFormatter(r.CCTR.CCTR2AtthCCTRRel.results[i].USMD_FILE_TYPE);I=new sap.ui.core.Icon({src:I,size:"3.0em"});var h=new sap.m.HBox({items:[I,d]}).addStyleClass("Hbox_padding");c.addContent(h);a.addItem(c);}if(a.getItems().length===0){sap.ui.getCore().byId("ccAttachFileUpload").destroy();}}});
