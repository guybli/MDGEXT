/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("fcg.mdg.approvecrv2.util.Formatter");jQuery.sap.require("fcg.mdg.approvecrv2.util.DataAccess");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Material.Material");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantCreate");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantChange");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.MatPlantDetails",{oPlantDataDetails:"",os4view:null,vPlant:"",vMaterial:"",RowId:0,sRowId:0,result:"",isNavToDetail:"",vPlantCreated:"",oValuationDetail:"",vScrollToPanel:"",vNoScrollback:"",i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),extHookMatmodifyPlantDetailsOnInit:null,extHookMatHidePlantGnrlDataSection:null,onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);this.getView().byId("PlantDetail").setShowNavButton(true);this.oDataManager=sap.ca.scfld.md.app.Application.getImpl().getComponent().getDataManager();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="matPlantDataDetail"){if(this.isNavToDetail!=="X"){this.loadPlantDetailLayout();this.RowId=e.getParameter('arguments').RowId;this.result=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getPlantNavData();this.setPlantObjHeader();var s=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getS3Instance();var d=s.getDecisions();s.createDecisionButtons(d,this,'navFromDetail');this.setPlantHeader();this.os4view=s;this.getSetPlantDetails();}this.isNavToDetail="";}else if(e.getParameter("name")==="matPlantPnlChngDetail"){if(this.isNavToDetail!=="X"){this.vNoScrollback="";this.loadPlantDetailLayout();var n=e.getParameter('arguments').NwVal;if(n===this.i18n.getText("PC_ADDED")){this.vPlantCreated="X";}else{this.vPlantCreated="";}var p=e.getParameter('arguments').PanelId;this.vPlant=e.getParameter('arguments').PLANT;this.vMaterial=e.getParameter('arguments').MATERIAL;var P=e.getParameter('arguments').ChangeKey;P=this.i18n.getText("plant")+": "+P;this.getView().byId("PlantDetailHeader").setTitle(P);var m=e.getParameter('arguments').MatText;m=this.i18n.getText("MATERIAL")+": "+m;this.getView().byId("MatrlHeader").setText(m);var s=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getS3Instance();var d=s.getDecisions();s.createDecisionButtons(d,this);var h=fcg.mdg.approvecrv2.util.Formatter.getChngPlantDetailHdr("Plant");var c=this.getView().byId("PlantDetail").getCustomHeader();c.destroyContentMiddle();c.addContentMiddle(new sap.m.Text({text:h}));if(sap.ui.getCore().byId("MatPlantBtnPrev")!==undefined&&sap.ui.getCore().byId("MatPlantBtnNext")!==undefined){sap.ui.getCore().byId("MatPlantBtnPrev").setVisible(false);sap.ui.getCore().byId("MatPlantBtnNext").setVisible(false);}this.os4view=s;this.getSetPlantDetails();if(p!=='general'){sap.ui.getCore().byId(p).setExpanded(true);this.vScrollToPanel=p;}else{this.vScrollToPanel="";}this.getView().addEventDelegate({onAfterShow:function(){if(this.os4view.sAction==="CHANGE"&&this.vNoScrollback!=="X"){var o=this.getView().byId("PlantDetail");this.vNoScrollback="X";if(this.vScrollToPanel!=='general'&&this.vScrollToPanel!==""){var E=document.getElementById(this.vScrollToPanel);var t=E.offsetTop;o.scrollTo(t,300);}else{o.scrollTo(0,300);}}}},this);}this.isNavToDetail="";}if(this.extHookMatmodifyPlantDetailsOnInit){this.extHookMatmodifyPlantDetailsOnInit(e,this,this.result);}},this);},navtoSubDetail:function(e,d){var p=e.getSource().getBindingContext().getPath();var r=p.substr(p.lastIndexOf("/")+1);this.isNavToDetail="X";switch(d.name){case"matStorageLocDetail":var s=d.Entity.MARCBASIC2MARDRel.results[r].LGORT;this.oRouter.navTo("matStorageLocDetail",{LGORT:s,RowId:r,Action:this.os4view.sAction});break;case"matPlantMrpTextDetail":this.oRouter.navTo("matPlantMrpTextDetail",{Action:this.os4view.sAction});break;case"matInsTypDetail":this.oRouter.navTo("matInsTypDetail",{RowId:r,Action:this.os4view.sAction});break;case"matMrpAreaDetail":this.oRouter.navTo("matMrpAreaDetail",{RowId:r,Action:this.os4view.sAction});break;case"matPrdVrsnDetail":this.oRouter.navTo("matPrdVrsnDetail",{RowId:r,Action:this.os4view.sAction});break;case"matValAreaDataDetail":var b=d.Entity.results[r].BWKEY;var a=d.Entity.results[r].BWTAR;if(a===""){a="Header";}this.oRouter.navTo("matValAreaDataDetail",{RowId:r,bwkey:b,bwtar:a});break;}},loadPlantDetailLayout:function(){if(this.oPlantDataDetails===""){this.oPlantDataDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.Material.MaterialPlantDetails',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("PlantDetail").removeContent(this.oPlantDataDetails);if(this.oPlantDataDetails!==undefined){this.oPlantDataDetails.destroy();}this.oPlantDataDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.Material.MaterialPlantDetails',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("PlantDetail").addContent(this.oPlantDataDetails);fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantCreate.checkPanelVisibleFlag();},setPlantHeader:function(){var T=this.result.MATERIAL2MARCBASICRel.results.length;this.sRowId=this.RowId;this.sRowId++;var c=this.getView().byId("PlantDetail").getCustomHeader();c.destroyContentMiddle();var P=fcg.mdg.approvecrv2.util.Formatter.getPlantDetailHdr("Plant",this.sRowId,T);c.addContentMiddle(new sap.m.Text({text:P}));var v=this;if(sap.ui.getCore().byId("MatPlantBtnPrev")===undefined&&sap.ui.getCore().byId("MatPlantBtnNext")===undefined){c.addContentRight(new sap.m.Button({id:"MatPlantBtnPrev",icon:"sap-icon://up",press:function(){v.loadPlantDetailLayout();v.RowId--;v.setPlantObjHeader();v.setPlantHeader();v.getSetPlantDetails();}}));c.addContentRight(new sap.m.Button({id:"MatPlantBtnNext",icon:"sap-icon://down",press:function(){v.loadPlantDetailLayout();v.RowId++;v.setPlantObjHeader();v.setPlantHeader();v.getSetPlantDetails();}}));}sap.ui.getCore().byId("MatPlantBtnPrev").setVisible(true);sap.ui.getCore().byId("MatPlantBtnNext").setVisible(true);if(this.sRowId===1){sap.ui.getCore().byId("MatPlantBtnPrev").setEnabled(false);sap.ui.getCore().byId("MatPlantBtnNext").setEnabled(true);}else if(this.sRowId===T){sap.ui.getCore().byId("MatPlantBtnNext").setEnabled(false);sap.ui.getCore().byId("MatPlantBtnPrev").setEnabled(true);}else{sap.ui.getCore().byId("MatPlantBtnNext").setEnabled(true);sap.ui.getCore().byId("MatPlantBtnPrev").setEnabled(true);}},setPlantObjHeader:function(){this.vPlant=this.result.MATERIAL2MARCBASICRel.results[this.RowId].WERKS;var p=this.result.MATERIAL2MARCBASICRel.results[this.RowId].WERKS__TXT;var P=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.vPlant,p);P=this.i18n.getText("plant")+": "+P;this.getView().byId("PlantDetailHeader").setTitle(P);this.vMaterial=this.result.MATERIAL2MARCBASICRel.results[this.RowId].MATERIAL;var m=this.result.TXTMI;var M=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.vMaterial,m);M=this.i18n.getText("Material")+": "+M;this.getView().byId("MatrlHeader").setText(M);},getSetPlantDetails:function(){var p="";var a=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getPlantDetailsData(this,this.vPlant,this.vMaterial);var P=new sap.ui.model.json.JSONModel();if(a[0].data.WERKS!==undefined){var r=a[0].data;P.setData(r);sap.ui.getCore().byId("matPlantDataForm").setModel(P);sap.ui.getCore().byId("matPlantSalesForm").setModel(P);sap.ui.getCore().byId("matPlantFtrdForm").setModel(P);sap.ui.getCore().byId("matPlantPurchForm").setModel(P);var b=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getGeneralDetailData();var B=b.data.MEINS;var v=b.data.MEINS__TXT;if(sap.ui.getCore().byId("Txt_VBAMG").getVisible()!==false){fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantCreate.setQtyWithUnit(B,v,"Txt_VBAMG");}sap.ui.getCore().byId("Txt_WERKS").setVisible(false);if(a[1].data.MARCBASIC2MLANPURCHRel.results.length>0){var m=a[1].data.MARCBASIC2MLANPURCHRel.results[0].TAIPURTAX;if(m!==""){var M=a[1].data.MARCBASIC2MLANPURCHRel.results[0].TAIPURTAX__TXT;m=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(m,M);sap.ui.getCore().byId("Txt_TAIPURTAX").setText(m);}else{sap.ui.getCore().byId("Txt_TAIPURTAX").setVisible(false);}}else{sap.ui.getCore().byId("Txt_TAIPURTAX").setVisible(false);}fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantCreate.hidePlantGnrlDataSection();if(this.os4view.sAction==='CHANGE'){if(r.ChangeData.results[0]!==undefined&&this.vPlantCreated===""){fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantChange.setBoldPlantGenData(r,p);}if(this.vPlantCreated===""&&a[1].data.MARCBASIC2MLANPURCHRel.results.length>0&&a[1].data.MARCBASIC2MLANPURCHRel.results[0].ChangeData.results[0]!==undefined){fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialPlantChange.setBoldPlantGenData(a[1].data.MARCBASIC2MLANPURCHRel.results[0],p);}}}else{if(this.extHookMatHidePlantGnrlDataSection){this.extHookMatHidePlantGnrlDataSection();}else{if(sap.ui.getCore().byId("matPlantDataForm")!==undefined&&sap.ui.getCore().byId("MatPlantCentral")!==undefined&&sap.ui.getCore().byId("matPlantSalesForm")!==undefined&&sap.ui.getCore().byId("Plnt_Sales")!==undefined&&sap.ui.getCore().byId("matPlantFtrdForm")!==undefined&&sap.ui.getCore().byId("Plant_FTrade")!==undefined&&sap.ui.getCore().byId("matPlantPurchForm")!==undefined&&sap.ui.getCore().byId("Plant_Purchsng_Data")!==undefined){sap.ui.getCore().byId("matPlantDataForm").destroy();sap.ui.getCore().byId("MatPlantCentral").destroy();sap.ui.getCore().byId("matPlantSalesForm").destroy();sap.ui.getCore().byId("Plnt_Sales").destroy();sap.ui.getCore().byId("matPlantFtrdForm").destroy();sap.ui.getCore().byId("Plant_FTrade").destroy();sap.ui.getCore().byId("matPlantPurchForm").destroy();sap.ui.getCore().byId("Plant_Purchsng_Data").destroy();}}}},getCreatedPlantFlag:function(){return this.vPlantCreated;},DestroyInstance:function(){if(this.oPlantDataDetails!==undefined&&this.oPlantDataDetails!==""){this.oPlantDataDetails.destroy();}if(this.oValuationDetail!==undefined&&this.oValuationDetail!==""){this.oValuationDetail.destroy();}}});
