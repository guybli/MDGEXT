/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("fcg.mdg.approvecrv2.util.Formatter");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialSalesCreate");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Material.Material");jQuery.sap.require("fcg.mdg.approvecrv2.util.DataAccess");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.MatSalesLongText",{oSalesDataTextDetails:"",flag:0,oSalesOrgInstance:"",sRowId:"",sRow:"",textData:"",aSalesDataLen:"",vSalesTextDetailTitle:"",aSalesTextDetailData:"",vAction:"",routerName:"",extHookmatHookModifySalesTextRouting:null,i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);this.getView().byId("SalesTextDetailPage").setShowNavButton(true);this.oDataManager=sap.ca.scfld.md.app.Application.getImpl().getComponent().getDataManager();this.oRouter.attachRouteMatched(function(e){var s;var d;if(e.getParameter("name")==="matSalesTextDetail"){this.routerName=e.getParameter("name");s=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getS3Instance();d=s.getDecisions();this.vAction=s.sAction;s.createDecisionButtons(d,this,'navFromDetail');this.loadSalesTextLayout();fcg.mdg.approvecrv2.util.Formatter.resetFormBolding(this.getView());this.sRowId=e.getParameter('arguments').RowId;if(this.vAction==="CREATE"){this.strSalesKey=e.getParameter('arguments').VKORG;this.strDisbKey=e.getParameter('arguments').VTWEG;this.strLangucode=e.getParameter('arguments').LANGUCODE;this.textData=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getSalesTaxData();this.aSalesDataLen=fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialSalesCreate.getSalesDataLen();}else if(this.vAction==="CHANGE"){this.textData=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getMVKESalesTextDetailData();this.strSalesKey=e.getParameter('arguments').VKORG;this.strDisbKey=e.getParameter('arguments').VTWEG;this.strLangucode=e.getParameter('arguments').LANGUCODE;this.aSalesTextDetailData=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.binarySearchSalesNDisb(this.strSalesKey,this.strDisbKey,this.textData.data.MATERIAL2MVKESALESRel);this.aSalesDataLen=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results.length;}this.setSalesObjHeader();this.setSalesHeader();this.bindLongTextData();}else if(e.getParameter("name")==="matSalesTextChangeDetail"){this.routerName=e.getParameter("name");this.loadSalesTextLayout();this.sRowId=e.getParameter('arguments').RowId;this.sCrId=e.getParameter('arguments').vCrId;this.matNum=e.getParameter('arguments').matNum;this.strSalesKey=e.getParameter('arguments').VKORG;this.strDisbKey=e.getParameter('arguments').VTWEG;this.strLangucode=e.getParameter('arguments').LANGUCODE;s=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getS3Instance();d=s.getDecisions();this.vAction=s.sAction;fcg.mdg.approvecrv2.util.Formatter.resetFormBolding(this.getView());this.textData=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getMVKESalesTextDetailData();this.aSalesTextDetailData=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.binarySearchSalesNDisb(this.strSalesKey,this.strDisbKey,this.textData.data.MATERIAL2MVKESALESRel);s.createDecisionButtons(d,this,'navFromDetail');this.setSalesObjHeader();this.setSalesHeader();this.bindSalesTextDetailData();}this.matHookModifySalesTextRouting(e.getParameter("name"),this);},this);},matHookModifySalesTextRouting:function(r,v){if(this.extHookmatHookModifySalesTextRouting){this.extHookmatHookModifySalesTextRouting(r,v);}},loadSalesTextLayout:function(){if(this.oSalesDataTextDetails===""){this.oSalesDataTextDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.Material.MatSalesTextDetails',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("SalesTextDetailPage").removeContent(this.oSalesDataTextDetails);if(this.oSalesDataTextDetails!==undefined){this.oSalesDataTextDetails.destroy();}this.oSalesDataTextDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.Material.MatSalesTextDetails',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("SalesTextDetailPage").removeContent(this.oSalesDataTextDetails);this.getView().byId("SalesTextDetailPage").addContent(this.oSalesDataTextDetails);},setSalesObjHeader:function(){var h;var S=this.getView().getModel("i18n").getProperty("SL_DIST_CHN");var s=fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();var m=this.i18n.getText("MATERIAL");var a=this.i18n.getText("Sl_ln");var k;var d;var t;var b;var c;this.oSalesOrgInstance=fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getMatSalesOrgInstance();if(this.vAction==="CREATE"){k=this.textData.data.MVKESALES2SALESTXTRel.results[this.sRowId].LANGUCODE;d=this.textData.data.MVKESALES2SALESTXTRel.results[this.sRowId].LANGUCODE__TXT;t=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);a=a+": "+t;s=m+": "+s;if(this.aSalesDataLen>1){h=fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialSalesCreate.setGetSalesObjHeader(this.oSalesOrgInstance.sRowId);}else{h=fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialSalesCreate.setGetSalesObjHeader(0);}this.getView().byId("SalesTextDetailHeader").setTitle(a);this.getView().byId("SalesOrgHeader").setText(h);this.getView().byId("MatrHeader").setText(s);}else if(this.vAction==="CHANGE"){for(var j=0;j<this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results.length;j++){if(this.routerName==="matSalesTextChangeDetail"){t=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].LANGUCODE;}else if(this.routerName==="matSalesTextDetail"&&this.vAction==="CREATE"){t=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].LANGUCODE,this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].LANGUCODE__TXT);}else if(this.routerName==="matSalesTextDetail"&&this.vAction==="CHANGE"){t=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].LANGUCODE;}if(t===this.strLangucode){k=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].LANGUCODE;d=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].LANGUCODE__TXT;t=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);b=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].VKORG,this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].VKORG__TXT);c=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].VTWEG,this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[j].VTWEG__TXT);h=S+": "+b+"/"+c;a=a+": "+t;}}s=m+": "+s;this.getView().byId("SalesTextDetailHeader").setTitle(a);this.getView().byId("SalesOrgHeader").setText(h);this.getView().byId("MatrHeader").setText(s);}},bindLongTextData:function(){var t;if(this.vAction==="CREATE"){t=this.textData.data.MVKESALES2SALESTXTRel.results[this.sRowId];}else if(this.vAction==="CHANGE"){t=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId];}var d=new sap.ui.model.json.JSONModel();d.setData(t);var e=this.getView().byId("SalesTextDetailPage");e.setModel(d);},setSalesHeader:function(){var c=this.getView().byId("SalesTextDetailPage").getCustomHeader();c.destroyContentMiddle();var v=this;var T;var r=this.getView().getModel("i18n").getProperty("DETAIL_TITLE");var a=this.getView().getModel("i18n").getProperty("MATERIAL");var d=this.getView().getModel("i18n").getProperty("SL_DIST_CHN");var t=this.getView().getModel("i18n").getProperty("Sl_txt");this.vSalesTextDetailTitle=r+": "+a+" - "+d;if(this.vAction==="CREATE"||this.routerName==="matSalesTextDetail"){if(this.vAction==="CREATE"&&this.routerName==="matSalesTextDetail"){T=this.textData.data.MVKESALES2SALESTXTRel.results.length;}else if(this.vAction!=="CREATE"&&this.routerName==="matSalesTextDetail"){T=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results.length;}if(sap.ui.getCore().byId("salesTextBtnPrev")===undefined&&sap.ui.getCore().byId("salesTextBtnNext")===undefined){c.addContentRight(new sap.m.Button({id:"salesTextBtnPrev",icon:"sap-icon://up",press:function(){v.loadSalesTextLayout();v.sRowId--;if(v.vAction==="CREATE"){v.setSalesObjHeader();}else if(v.vAction==="CHANGE"){v.setSalesChangeObjTextHeader();}v.setSalesHeader();v.bindLongTextData();}}));c.addContentRight(new sap.m.Button({id:"salesTextBtnNext",icon:"sap-icon://down",press:function(){v.loadSalesTextLayout();v.sRowId++;if(v.vAction==="CREATE"){v.setSalesObjHeader();}else if(v.vAction==="CHANGE"){v.setSalesChangeObjTextHeader();}v.setSalesHeader();v.bindLongTextData();}}));}sap.ui.getCore().byId("salesTextBtnNext").setVisible(true);sap.ui.getCore().byId("salesTextBtnPrev").setVisible(true);this.sRow=this.sRowId;this.sRow++;if(this.sRow===1){if(T===1){sap.ui.getCore().byId("salesTextBtnNext").setVisible(false);sap.ui.getCore().byId("salesTextBtnPrev").setVisible(false);}else{sap.ui.getCore().byId("salesTextBtnPrev").setEnabled(false);sap.ui.getCore().byId("salesTextBtnNext").setEnabled(true);}}else if(this.sRow===T){sap.ui.getCore().byId("salesTextBtnNext").setEnabled(false);sap.ui.getCore().byId("salesTextBtnPrev").setEnabled(true);}else{sap.ui.getCore().byId("salesTextBtnNext").setEnabled(true);sap.ui.getCore().byId("salesTextBtnPrev").setEnabled(true);}this.vSalesTextDetailTitle=this.vSalesTextDetailTitle+" - "+t+" ("+this.sRow+"/"+T+")";}else if(this.vAction==="CHANGE"){T=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results.length;if(sap.ui.getCore().byId("salesTextBtnPrev")!==undefined&&sap.ui.getCore().byId("salesTextBtnNext")!==undefined){sap.ui.getCore().byId("salesTextBtnNext").setVisible(false);sap.ui.getCore().byId("salesTextBtnPrev").setVisible(false);}this.vSalesTextDetailTitle=this.vSalesTextDetailTitle+"-"+t;}c.addContentMiddle(new sap.m.Text({text:this.vSalesTextDetailTitle}));},setChangeSalesHeader:function(){var r=this.i18n.getText("DETAIL_TITLE");this.getView().byId("SalesTextDetailPage").setTitle(r);},bindSalesTextDetailData:function(){var s=this.i18n.getText("MATERIAL")+": "+fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();var S=new sap.ui.model.json.JSONModel();var v=sap.ui.getCore().byId("mattextSalesdetail");for(var i=0;i<this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results.length;i++){for(var j=0;j<this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results.length;j++){if(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].LANGUCODE===this.strLangucode&&this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].Entity==="SALESTXT"&&this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].Attribute==="TXTSALES"&&this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].EntityAction!=="D"){this.setBoldSalesData(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i]);S.setData(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i]);v.setModel(S);return;}else if(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].LANGUCODE===this.strLangucode&&this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].Entity==="SALESTXT"&&this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].Attribute==="TXTSALES"&&this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].EntityAction==="D"){var t=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].ChangeData.results[j].OldValue;this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i].TXTSALES=t;S.setData(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[i]);v.setModel(S);}}}},setChangeSalesObjHeader:function(r){var d=this.i18n.getText("SL_DIST_CHN");var s=d+": "+r.VKORG__TXT+" ("+r.VKORG+") / "+" "+r.VTWEG__TXT+" ("+r.VTWEG+")";return s;},setBoldSalesData:function(r){var s="text_bold";for(var j=0;j<r.ChangeData.results.length;j++){var l="LBL_"+r.ChangeData.results[j].Attribute;var L=sap.ui.getCore().byId(l);if(r.ChangeData.results[j].EntityAction!==fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.vNewEntity){if(L!==undefined){L.setDesign("Bold");}var t="Txt_"+r.ChangeData.results[j].Attribute;if(sap.ui.getCore().byId(t)!==undefined){sap.ui.getCore().byId(t).addStyleClass(s);}}}},setSalesChangeObjTextHeader:function(){var S=this.i18n.getText("Sl_ln");var k;var d;var t;var s;var a;var h;k=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId].LANGUCODE;d=this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId].LANGUCODE__TXT;t=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);s=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId].VKORG,this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId].VKORG__TXT);a=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId].VTWEG,this.aSalesTextDetailData.MVKESALES2SALESTXTRel.results[this.sRowId].VTWEG__TXT);h=this.getView().getModel("i18n").getProperty("SL_DIST_CHN")+": "+s+"/"+a;S=S+": "+t;var v=this.i18n.getText("MATERIAL")+": "+fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();this.getView().byId("SalesTextDetailHeader").setTitle(S);this.getView().byId("SalesOrgHeader").setText(h);this.getView().byId("MatrHeader").setText(v);}});
