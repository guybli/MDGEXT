/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Customer");jQuery.sap.require("fcg.mdg.approvecrv2.util.Formatter");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Supplier");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.RelDetail",{oItemWorkplace:"",wpstrResults:{dataitems:[]},extHookModifyRelDetailFormData:null,extHookModifyRelationStyleClass:null,extHookModifyWPTableFormData:null,sPath:"",vDomain:"",onInit:function(){this.getView().byId("relPage").setShowNavButton(true);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="RelDetail"){this.vDomain=e.getParameter('arguments').Domain;var s=fcg.mdg.approvecrv2.DomainSpecParts[this.vDomain].getS3Instance();var d=s.getDecisions();s.createDecisionButtons(d,this,'navFromDetail');fcg.mdg.approvecrv2.util.Formatter.resetFormBolding(this.getView());var c=e.getParameter('arguments').Category;var p=e.getParameter('arguments').Partner1;var P=e.getParameter('arguments').Partner2;var C=e.getParameter('arguments').ChangeKey;var r=fcg.mdg.approvecrv2.DomainSpecParts[this.vDomain].oRelData.BP_Root.BP_RelationsRel;fcg.mdg.approvecrv2.DomainSpecParts[this.vDomain].setRouter(this.oRouter);this.displayRelDetails(r,p,P,c,C);this.getView().rerender();}},this);},PressBack:function(){var e=this.getView().byId("SimpleFormRel");e.destroyContent();},onAfterRendering:function(){this.hideSection();},getRelTemplate:function(m){var t=this;var i=new sap.m.ColumnListItem({type:"Navigation",cells:[new sap.m.Text({text:{path:"ADDRESS_NUMBER__TXT",formatter:function(){var a=m.getProperty('ADDRESS_NUMBER__TXT',this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"ADDRESS_NUMBER");if(t.isNull(a))return fcg.mdg.approvecrv2.util.Formatter.noValue("");return a;}}}),new sap.m.Text({text:{path:"BP_WorkplaceCommStandardPhoneR/TELEPHONE__TXT",formatter:function(){var w=m.getProperty('BP_WorkplaceCommStandardPhoneR/TELEPHONE__TXT',this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"BP_WorkplaceCommStandardPhoneR/TELEPHONE");if(t.isNull(w))return fcg.mdg.approvecrv2.util.Formatter.noValue("");return w;}}}),new sap.m.Text({text:{path:"BP_WorkplaceCommStandardMobile/TELEPHONE__TXT",formatter:function(){var w=m.getProperty('BP_WorkplaceCommStandardMobile/TELEPHONE__TXT',this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"BP_WorkplaceCommStandardMobile/TELEPHONE");if(t.isNull(w))return fcg.mdg.approvecrv2.util.Formatter.noValue("");return w;}}}),new sap.m.Text({text:{path:"BP_WorkplaceCommStandardEMailR/E_MAIL",formatter:function(){var w=m.getProperty('BP_WorkplaceCommStandardEMailR/E_MAIL',this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"BP_WorkplaceCommStandardEMailR/E_MAIL");if(t.isNull(w))return fcg.mdg.approvecrv2.util.Formatter.noValue("");return w;}}}),new sap.m.Text({text:{path:"STANDARDADDRESS",formatter:function(){var c=this.getBindingContext();var s=m.getProperty("STANDARDADDRESS",c);if(s==="X"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"STANDARDADDRESS");s=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText("PC_YES");}else{fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"STANDARDADDRESS");s=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText("PC_NO");}return s;}}})]});return i;},displayRelDetails:function(r,p,P,c,C){var e="";var m="";var E="";P=isNaN(parseInt(P))?P:parseInt(P);for(var i=0;i<r.results.length;i++){var R=null;var s="";var v=r.results[i].PARTNER1;var a=isNaN(parseInt(r.results[i].PARTNER2))?r.results[i].PARTNER2:parseInt(r.results[i].PARTNER2);var b=r.results[i].RELATIONSHIPCATEGORY;var d=r.results[i].RELATIONSHIPCATEGORY__TXT;if(v===p&&a===P&&b===c){if(r.results[i].BP_RelationContactPersonRel!==null){R=r.results[i].BP_RelationContactPersonRel;if(r.results[i].DEFAULTRELATIONSHIP==='X')R.DEFAULTRELATIONSHIP=r.results[i].DEFAULTRELATIONSHIP;R.RELATIONSHIPCATEGORY__TXT=r.results[i].RELATIONSHIPCATEGORY__TXT;if(this.extHookModifyRelDetailFormData){e=this.extHookModifyRelDetailFormData(R);if(e!==undefined){R=e;}}m=new sap.ui.model.json.JSONModel();m.setData(R);E=this.getView().byId("SimpleFormRel");if(E!==undefined){E.setModel(m);}s=r.results[i].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel;for(var j=0;j<s.results.length;j++){s.results[j].Domain=this.vDomain;}if(this.extHookModifyWPTableFormData){e=this.extHookModifyWPTableFormData(s);if(e!==undefined){s=e;}}this.wpstrResults=s;}else{if(this.extHookModifyRelDetailFormData){e=this.extHookModifyRelDetailFormData(R);if(e!==undefined){R=e;}}R=r.results[i];m=new sap.ui.model.json.JSONModel();m.setData(R);E=this.getView().byId("SimpleFormRel");if(E!==undefined){E.setModel(m);}s=" ";this.wpstrResults=s;}if(R.ChangeData.results!==undefined){if(R.ChangeData.results.length>0){var S="text_bold";var L="";var o="";var t="";var T="";var l="";if(this.extHookModifyRelationStyleClass){var n=this.extHookModifyRelationStyleClass(S);if(n!==undefined){S=n;}}for(l=0;l<R.ChangeData.results.length;l++){L="lbl"+R.ChangeData.results[l].Attribute;o=this.getView().byId(L);if(o!==undefined){o.setDesign("Bold");}t=R.ChangeData.results[l].Attribute;if(this.getView().byId(t)!==undefined){this.getView().byId(t).addStyleClass(S);}}for(l=0;l<r.results[i].ChangeData.results.length;l++){L="lbl"+r.results[i].ChangeData.results[l].Attribute;o=this.getView().byId(L);if(o!==undefined){o.setDesign("Bold");}t=r.results[i].ChangeData.results[l].Attribute;if(this.getView().byId(t)!==undefined){this.getView().byId(t).addStyleClass(S);}}}}var f="";if(C==="BP_ContactPerson"){f=this.getView().getModel("i18n").getProperty("ContactPersonText")+": "+R.PARTNER2__TXT+", "+this.getView().getModel("i18n").getProperty("RelDetails")+": "+d+"("+R.RELATIONSHIPCATEGORY+")";}else{var g=isNaN(parseInt(R.PARTNER2))?R.PARTNER2:parseInt(R.PARTNER2);f=this.getView().getModel("i18n").getProperty("RelDetails")+": "+d+"("+R.RELATIONSHIPCATEGORY+")"+", "+this.getView().getModel("i18n").getProperty("ContactPersonText")+": "+R.PARTNER2__TXT+"("+g+")";}var h=this.getView().byId("relDetailHeader");h.setTitle(f);var k=fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();this.getView().byId("relAttrHeader").setText(k);if(s.results!==undefined&&s.results.length!==0){m=new sap.ui.model.json.JSONModel();m.setData(s);var I=this.getRelTemplate(m);I.attachPress({EntityData:this.aRelations,EntityName:'BP_WorkplaceAddress',ChangeData:s},this.navigatetoWPAddress,' ');T=this.getView().byId("wpaddress");T.setVisible(true);T.setModel(m);T.bindItems("/results",I);}else{T=this.getView().byId("wpaddress");T.setVisible(false);}}}},navigatetoWPAddress:function(e){this.bindingContext=e.getSource("listItem").getBindingContext();if(this.bindingContext!==undefined){this.sPath=e.getSource("listItem").getBindingContext().sPath;}else{this.bindingContext=e.getParameter("listItem").getBindingContext();this.sPath=e.getParameter("listItem").getBindingContext().sPath;}var p="";p=this.sPath.split("/");var c=this.bindingContext.oModel.oData.results[p[2]];var a=c.ADDRESS_NUMBER;var P=c.PARTNER1;var v=c.PARTNER2;var C=c.RELATIONSHIPCATEGORY;var E=c.Domain;this.oRouter=fcg.mdg.approvecrv2.DomainSpecParts[E].getRouter();if(C!==""&&P!==""&&v!==""&&a!==""){this.oRouter.navTo("WPAddressDetail",{Category:C,Domain:E,Partner1:P,Partner2:v,Address_number:a});}},hideSection:function(){if(this.getView().byId("DEPARTMENT").getText()===""&&this.getView().byId("FUNCTION").getText()===""&&this.getView().byId("AUTHORITY").getText()===""&&this.getView().byId("VIP").getText()===""&&this.getView().byId("COMMENTS").getText()===""&&this.getView().byId("CPDetails")!==undefined){var c=this.getView().byId('CPDetails').getId();$('#'+c).hide();}},isNull:function(v){return typeof v==="undefined"||v==='unknown'||v===null||v==='null'||v===''||parseInt(v)===0;}});
