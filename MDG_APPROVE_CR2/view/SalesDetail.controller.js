/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.DateTime");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Customer");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.SalesDetail",{salekey:"",oItemTempPf:"",oSalesDetail:"",oS3Instance:"",subheader:"",oCompCodeDetails:"",extHookdisplaySaleData:null,extHookModifyStyleClass:null,extHookTaxCategoryTable:null,extHookPartnerFuncTable:null,oItemTempTax:"",onInit:function(){this.getView().byId("SalesPage").setShowNavButton(true);this.oS3Instance=fcg.mdg.approvecrv2.DomainSpecParts.Customer.getS3Instance();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="Sales"){var d=this.oS3Instance.getDecisions();this.oS3Instance.createDecisionButtons(d,this,'navFromDetail');fcg.mdg.approvecrv2.util.Formatter.resetFormBolding(this.getView());var a=e.getParameter("arguments");this.salekey=a.Key;var r=fcg.mdg.approvecrv2.DomainSpecParts.Customer.getNavData();if(this.oS3Instance.oSalesCreateForm!==""){this.oS3Instance.oSalesCreateForm.destroy();}if(this.oS3Instance.oSalesDetail===""){this.oS3Instance.oSalesDetail=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.SalesDetail',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("SalesPage").removeContent(this.oS3Instance.oSalesDetail);if(this.oS3Instance.oSalesDetail!==undefined){this.oS3Instance.oSalesDetail.destroy();}this.oS3Instance.oSalesDetail=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.SalesDetail',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("SalesPage").addContent(this.oS3Instance.oSalesDetail);this.displaySaleData(r);if(this.extHookdisplaySaleData){this.extHookdisplaySaleData(r);}}},this);},getTaxcategoryTemplate:function(m){var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"ALAND__TXT",formatter:function(){var d=m.getProperty("ALAND__TXT",this.getBindingContext());var k=m.getProperty("ALAND",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"ALAND");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}}}),new sap.m.Text({text:{path:"TATYP__TXT",formatter:function(){var d=m.getProperty("TATYP__TXT",this.getBindingContext());var k=m.getProperty("TATYP",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TATYP");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}}}),new sap.m.Text({text:{path:"TAXKD__TXT",formatter:function(){var d=m.getProperty("TAXKD__TXT",this.getBindingContext());var k=m.getProperty("TAXKD",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TAXKD");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}}})]});if(this.extHookTaxCategoryTable){i=this.extHookTaxCategoryTable(m);}return i;},getPartnerFuncTemplate:function(m){var t=this;var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"PARVW__TXT",formatter:function(){var d=m.getProperty("PARVW__TXT",this.getBindingContext());var k=m.getProperty("PARVW",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"PARVW");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}}}),new sap.m.Text({text:{path:"REFLEXIVE__TXT",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"REFLEXIVE");var d=m.getProperty("REFLEXIVE__TXT",this.getBindingContext());if(d!=="")return d;else return t.getView().getModel("i18n").getProperty("PC_NO");}}}),new sap.m.Text({text:{path:"KUNN2__TXT",formatter:function(){var d=m.getProperty("KUNN2__TXT",this.getBindingContext());var k=m.getProperty("KUNN2",this.getBindingContext());var c=m.getProperty("PARNR__TXT",this.getBindingContext());var a=m.getProperty("PARNR",this.getBindingContext());var p=m.getProperty("PERNR__TXT",this.getBindingContext());var b=m.getProperty("PERNR",this.getBindingContext());var v=m.getProperty("LIFNR__TXT",this.getBindingContext());var e=m.getProperty("LIFNR",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"KUNN2");a=(parseInt(a)===0)?"":parseInt(a,10);b=(parseInt(b)===0)?"":parseInt(b,10);if((t.isNull(c)||c==="")&&(t.isNull(a)||a==="")&&(t.isNull(k)||k==="")&&(t.isNull(d)||d==="")&&(t.isNull(b)||b==="")&&(t.isNull(p)||p==="")&&(t.isNull(e)||e==="")&&(t.isNull(v)||v==="")){return fcg.mdg.approvecrv2.util.Formatter.noValue("");}if(c!==""||a!==""){return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(a,c);}if(k!==""||d!==""){return fcg.mdg.approvecrv2.util.Formatter.description(k,d);}if(b!==""||p!==""){return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(b,p);}if(e!==""||v!==""){return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(e,v);}}}}),new sap.m.Text({text:{path:"KNREF",formatter:function(){var p=m.getProperty("KNREF",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"KNREF");if(t.isNull(p)||p==="")return fcg.mdg.approvecrv2.util.Formatter.noValue("");return p;}}}),new sap.m.Text({text:{path:"DEFPA__TXT",formatter:function(){var d=m.getProperty("DEFPA__TXT",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"DEFPA");if(t.isNull(d)||d==="")return fcg.mdg.approvecrv2.util.Formatter.noValue("");return d;}}})]});if(this.extHookPartnerFuncTable){i=this.extHookPartnerFuncTable(m);}return i;},displaySaleData:function(r){for(var i=0;i<r.results.length;i++){if(r.results.length>1){var a="";if(!this.isNull(r.results[i].CU_AssignedCustomerRel)){var c=r.results[i].CU_AssignedCustomerRel;if(!this.isNull(c.KTOKD)&&!this.isNull(c.KTOKD__TXT)){a=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(c.KTOKD,c.KTOKD__TXT);}}this.subheader=fcg.mdg.approvecrv2.DomainSpecParts.CustomerCreate.getSubheaderWithAccGrp(r.results[i].STANDARD,r.results[i].OBJECT_ID,r.results[i].REASON_ID__TXT,a);}else{this.subheader="";}for(var j=0;j<r.results[i].CU_AssignedSalesAreasRel.results.length;j++){var s="";var e="";var m="";var A=r.results[i].CU_AssignedSalesAreasRel.results[j];var o=A.VKORG;var C=A.VTWEG;var d=A.SPART;var k=A.ASSIGNMENT_ID+o+C+d;if(k===this.salekey){o=A.VKORG__TXT+"("+A.VKORG+")";C=A.VTWEG__TXT+"("+A.VTWEG+")";d=A.SPART__TXT+"("+A.SPART+")";var h=o+","+C+","+d;this.getView().byId("ccObjHeaderDet").setTitle(this.getView().getModel("i18n").getProperty("salesarea")+": "+h);var b=fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();this.getView().byId("bpdesc").setText(b);this.getView().byId("erpCustSales").setText(this.subheader);var F=A;m=new sap.ui.model.json.JSONModel();m.setData(F);e=sap.ui.getCore().byId("SimpleFormSales");e.setModel(m);if(A.ChangeData.results!==undefined&&A.ChangeData.results.length>0){var S="text_bold";if(this.extHookModifyStyleClass){var n=this.extHookModifyStyleClass(S);if(n!==undefined){S=n;}}for(var l=0;l<A.ChangeData.results.length;l++){var L="lbl"+A.ChangeData.results[l].Attribute;var f="lblsale"+A.ChangeData.results[l].Attribute;var g=sap.ui.getCore().byId(L);var N=sap.ui.getCore().byId(f);if(g!==undefined){g.setDesign("Bold");}if(N!==undefined){N.setDesign("Bold");}var t=A.ChangeData.results[l].Attribute;var p="sale"+A.ChangeData.results[l].Attribute;if(sap.ui.getCore().byId(t)!==undefined){sap.ui.getCore().byId(t).addStyleClass(S);}if(sap.ui.getCore().byId(p)!==undefined){sap.ui.getCore().byId(p).addStyleClass(S);}}}fcg.mdg.approvecrv2.DomainSpecParts.Customer.hideSaleSection();var E=sap.ui.getCore().byId("lblVKORG");E.setVisible(false);var v=sap.ui.getCore().byId("lblVTWEG");v.setVisible(false);var q=sap.ui.getCore().byId("lblSPART");q.setVisible(false);var u=sap.ui.getCore().byId("VKORG");u.setVisible(false);var w=sap.ui.getCore().byId("VTWEG");w.setVisible(false);var x=sap.ui.getCore().byId("SPART");x.setVisible(false);var y=sap.ui.getCore().byId("lblSalesErpcust");y.setVisible(false);if(A.CU_SalesPartnerFunctionsRel.results!==undefined&&A.CU_SalesPartnerFunctionsRel.results.length>0){s=A.CU_SalesPartnerFunctionsRel;m=new sap.ui.model.json.JSONModel();m.setData(s);e=sap.ui.getCore().byId("partnerfunc");e.setVisible(true);e.setModel(m);this.oItemTempPf=this.getPartnerFuncTemplate(m);e.bindItems("/results",this.oItemTempPf);}else{sap.ui.getCore().byId("partnerfunc").setVisible(false);}if(A.CU_SalesTaxIndicatorsRel.results!==undefined&&A.CU_SalesTaxIndicatorsRel.results.length>0){s=A.CU_SalesTaxIndicatorsRel;m=new sap.ui.model.json.JSONModel();m.setData(s);e=sap.ui.getCore().byId("taxindic");e.setVisible(true);e.setModel(m);this.oItemTempTax=this.getTaxcategoryTemplate(m);e.bindItems("/results",this.oItemTempTax);}else{sap.ui.getCore().byId("taxindic").setVisible(false);}}}}},isNull:function(v){return typeof v==="undefined"||v==='unknown'||v===null||v==='null'||parseInt(v)===0;}});
