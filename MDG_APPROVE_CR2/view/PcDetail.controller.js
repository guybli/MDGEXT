/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.ProfitCenterCreate");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.ProfitCenterChange");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.ProfitCenter");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.PcDetail",{aDetailData:"",oProfitCenterDetails:"",extHookPCModifyDetailFormData:null,extHookPCModifyStyleClass:null,extHookPCHideDetailAddressSection:null,extHookPCHideDetailCommSection:null,extHookPCDetailDescTemplate:null,extHookPCDetDescriptionTable:null,i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);this.getView().byId("pcDetail").setShowNavButton(true);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="pcItemDetail"){if(this.oProfitCenterDetails===""){this.oProfitCenterDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.ProfitCenterDetails',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("pcDetail").removeContent(this.oProfitCenterDetails);this.oProfitCenterDetails.destroy();this.oProfitCenterDetails=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.ProfitCenterDetails',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("pcDetail").addContent(this.oProfitCenterDetails);var d=fcg.mdg.approvecrv2.DomainSpecParts.ProfitCenterChange.getDetailData();var s=fcg.mdg.approvecrv2.DomainSpecParts.ProfitCenter.getS3Instance();var D=s.getDecisions();s.createDecisionButtons(D,this,'navFromDetail');if(this.extHookPCModifyDetailFormData){var a=this.extHookPCModifyDetailFormData(d);if(a!==undefined){d=a;}}this.aDetailData=d;var o=new sap.ui.model.json.JSONModel();o.setData(d);sap.ui.getCore().byId("pcDetailSimpleForm").setModel(o);this.getView().byId("objHeaderDet").setModel(o);this.getView().byId("objHeaderDet").setTitle(d.PCTR.TXTSH+"("+d.PCTR.COAREA+"/"+d.PCTR.PCTR+")");var t=sap.ui.getCore().byId("pcDetDescriptionTable");this.setStyleForChangedTable(d,t);var c=sap.ui.getCore().byId("pcDetCompCodeTable");this.setStyleForChangedCompTable(d,c);var S="text_bold";if(this.extHookPCModifyStyleClass){var n=this.extHookPCModifyStyleClass(S);if(n!==undefined){S=n;}}for(var i=0;i<d.PCTR.ChangeData.results.length;i++){var l="LBL_"+d.PCTR.ChangeData.results[i].Attribute;var L=sap.ui.getCore().byId(l);if(L!==undefined){L.setDesign("Bold");}var T="TXT_"+d.PCTR.ChangeData.results[i].Attribute;if(sap.ui.getCore().byId(T)!==undefined){sap.ui.getCore().byId(T).addStyleClass(S);}}this.createAttachmentList(this.aDetailData);this.hideSection(this.aDetailData);this.hideTable(this.aDetailData);}},this);},hideSection:function(r){if(this.extHookPCHideDetailAddressSection){this.extHookPCHideDetailAddressSection();}else{if(r.PCTR.PC_STRAS===""&&r.PCTR.PC_PSTLZ===""&&r.PCTR.PC_ORT01===""&&r.PCTR.PC_ORT02===""&&r.PCTR.PC_LAND1===""&&r.PCTR.PC_REGION===""&&r.PCTR.PC_PSTL2===""&&r.PCTR.PCTRTXJCD===""&&r.PCTR.PC_ANRED===""&&r.PCTR.PC_NAME1===""&&r.PCTR.PC_NAME2===""&&r.PCTR.PC_NAME3===""&&r.PCTR.PC_NAME4===""){sap.ui.getCore().byId("pcDetAddress").destroy();}}if(this.extHookPCHideDetailCommSection){this.extHookPCHideDetailCommSection();}else{if(r.PCTR.PC_TELF1===""&&r.PCTR.PC_DATLT===""&&r.PCTR.PC_SPRAS===""&&r.PCTR.PC_TELF2===""&&r.PCTR.PC_TELFX===""&&r.PCTR.PC_TELTX===""&&r.PCTR.PC_TELX1===""&&r.PCTR.PC_TELBX===""&&r.PCTR.PC_DRNAM===""){sap.ui.getCore().byId("pcDetComm").destroy();}}if(r.PCTR.PCTRLKIND===""){sap.ui.getCore().byId("pcDetInd").destroy();}},hideTable:function(r){if(r.PCTR.PCTR2PCCCASSRel.results.length===0)sap.ui.getCore().byId("pcDetCompCodeTable").setVisible(false);if(r.PCTR.PCTR2DTxtPCTRRel.results.length===0)sap.ui.getCore().byId("pcDetDescriptionTable").setVisible(false);if(r.PCTR.PCTR2AtthPCTRRel.results.length===0)sap.ui.getCore().byId("pcDetAttachList").setVisible(false);},setStyleForChangedTable:function(r,t){if(r.PCTR.PCTR2DTxtPCTRRel.results.length>0){var m=new sap.ui.model.json.JSONModel();m.setData(r.PCTR.PCTR2DTxtPCTRRel);for(var i=0;i<m.oData.results.length;i++){if(m.oData.results[i].ChangeData!==undefined){for(var j=0;j<m.oData.results[i].ChangeData.results.length;j++){if(m.oData.results[i].ChangeData.results[j].EntityAction==='D')m.oData.results[i].ChangeData.results[j].Attribute="";}}}t.setVisible(true);t.setModel(m);var I=this.getDescTemplate(m);t.bindItems("/results",I);}},getDescTemplate:function(m){var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"CD_LANGU/Description",formatter:function(){var d=m.getProperty("CD_LANGU/Description",this.getBindingContext());var k=m.getProperty("CD_LANGU/Code",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LANGU");return fcg.mdg.approvecrv2.util.Formatter.noValue(fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d));}}}),new sap.m.Text({text:{path:"TXTSH",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTSH");return fcg.mdg.approvecrv2.util.Formatter.noValue(m.getProperty('TXTSH',this.getBindingContext()));}}}),new sap.m.Text({text:{path:"TXTMI",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"TXTMI");return fcg.mdg.approvecrv2.util.Formatter.noValue(m.getProperty('TXTMI',this.getBindingContext()));}}})]});return i;},setStyleForChangedCompTable:function(r,t){if(r.PCTR.PCTR2PCCCASSRel.results.length>0){var m=new sap.ui.model.json.JSONModel();m.setData(r.PCTR.PCTR2PCCCASSRel);t.setVisible(true);t.setModel(m);var i=this.getCompCodeTemplate(m);t.bindItems("/results",i);}},getCompCodeTemplate:function(m){var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"CD_COMPCODE/Description",formatter:function(){var d=m.getProperty("CD_COMPCODE/Description",this.getBindingContext());var k=m.getProperty("CD_COMPCODE/Code",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"COMPCODE");return fcg.mdg.approvecrv2.util.Formatter.noValue(fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d));}}}),new sap.m.Text({text:{path:"PCTRCCASS",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"PCTRCCASS");var p=m.getProperty('PCTRCCASS',this.getBindingContext());return fcg.mdg.approvecrv2.util.Formatter.noValue(fcg.mdg.approvecrv2.util.Formatter.checkBox(p));}}})]});return i;},validityFormatter:function(v,V){var t="";var f="";if(v===""||v===null||v===undefined||V===""||V===null||V===undefined)return"";if(v){f=sap.ca.ui.model.format.DateFormat.getDateInstance().format(v);}if(V){t=sap.ca.ui.model.format.DateFormat.getDateInstance().format(V);}return this.i18n.getText("Validity")+": "+f+" - "+t;},createAttachmentList:function(r){var a=sap.ui.getCore().byId("pcDetAttachList");var c=new sap.m.CustomListItem({});var C="";var l="";for(var i=0;i<r.PCTR.PCTR2AtthPCTRRel.results.length;i++){var L="";if(r.PCTR.PCTR2AtthPCTRRel.results[i].USMD_LINK!=="")L=r.PCTR.PCTR2AtthPCTRRel.results[i].USMD_LINK;else L=r.PCTR.PCTR2AtthPCTRRel.results[i].__metadata.media_src;var f=fcg.mdg.approvecrv2.util.Formatter.dateFormatter(r.PCTR.PCTR2AtthPCTRRel.results[i].USMD_ACREATED_AT)+" "+this.i18n.getText('AttachBy')+" ";var v=" "+r.PCTR.PCTR2AtthPCTRRel.results[i].CD_USMD_ACREATED_BY.Description+"("+r.PCTR.PCTR2AtthPCTRRel.results[i].CD_USMD_ACREATED_BY.Code+")";var b="";for(var j=0;j<r.PCTR.PCTR2AtthPCTRRel.results[i].ChangeData.results.length;j++){b=f+" "+v;break;}if(b!==""){C=new sap.m.Text({text:f+" "+v}).addStyleClass("text_bold");l=true;for(var j=0;j<r.PCTR.PCTR2AtthPCTRRel.results[i].ChangeData.results.length;j++){if(r.PCTR.PCTR2AtthPCTRRel.results[i].ChangeData.results[j].EntityAction==='D')C.addStyleClass('sapThemeText');}}else{C=new sap.m.Text({text:f+" "+v});l=false;}var A=new sap.m.Link({text:r.PCTR.PCTR2AtthPCTRRel.results[i].USMD_TITLE,target:"_blank",href:L,wrapping:true,subtle:false,emphasized:l}).addStyleClass("padding_bottom");for(var j=0;j<r.PCTR.PCTR2AtthPCTRRel.results[i].ChangeData.results.length;j++){if(r.PCTR.PCTR2AtthPCTRRel.results[i].ChangeData.results[j].EntityAction==='D'){A.setHref("");A.addStyleClass('sapThemeText');}}var d=new sap.m.VBox({items:[A,C]}).addStyleClass("padding_left");var I=fcg.mdg.approvecrv2.util.Formatter.mimeTypeFormatter(r.PCTR.PCTR2AtthPCTRRel.results[i].USMD_FILE_TYPE);var o=new sap.ui.core.Icon({src:I,size:"3.0em"});var h=new sap.m.HBox({items:[o,d]}).addStyleClass("Hbox_padding");c.addContent(h);a.addItem(c);}}});
