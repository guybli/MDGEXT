/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.DateTime");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Customer");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.CustomerChange");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.mdg.approvecrv2.view.PurchasingDetail",{compCode:"",oItemTemp:"",oCompCodeDetails:"",oSalesDetail:"",bindingContext:"",sPath:"",oS3Instance:"",subheader:"",extHooknavtoDetail:null,extHookModifyStyleClass:null,extHookWithhldTable:null,extHookDunningTable:null,extHookdisplayCompCodedata:null,changerequestId:"",onInit:function(){var s="text_bold";this.getView().byId("PurchasingPage").removeStyleClass(s);this.getView().byId("PurchasingPage").setShowNavButton(true);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="Purchase"){this.oS3Instance=fcg.mdg.approvecrv2.DomainSpecParts.Supplier.getS3Instance();var d=this.oS3Instance.getDecisions();this.oS3Instance.createDecisionButtons(d,this,'navFromDetail');var a=e.getParameter("arguments");this.CompCode=a.Key;this.changerequestId=a.ChangeRequestID;this.contextPath=a.contextPath;var r=fcg.mdg.approvecrv2.DomainSpecParts.Supplier.getNavData();fcg.mdg.approvecrv2.DomainSpecParts.Supplier.setRouter(this.oRouter);fcg.mdg.approvecrv2.DomainSpecParts.Supplier.setContextPath(this.changerequestId);fcg.mdg.approvecrv2.DomainSpecParts.Supplier.setChangeRequest(this.contextPath);this.result=r;if(this.oS3Instance.oPurchaseCreateForm!==""){this.oS3Instance.oPurchaseCreateForm.destroy();}if(this.oS3Instance.oPurchaseDetail===""||this.oS3Instance.oPurchaseDetail===undefined){this.oS3Instance.oPurchaseDetail=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.PurchasingDetail',fcg.mdg.approvecrv2.util.Formatter);}else{this.getView().byId("FormPurchase").removeContent(this.oS3Instance.oPurchaseDetail);if(this.oS3Instance.oPurchaseDetail!==undefined){this.oS3Instance.oPurchaseDetail.destroy();}this.oS3Instance.oPurchaseDetail=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.PurchasingDetail',fcg.mdg.approvecrv2.util.Formatter);}this.getView().byId("FormPurchase").addContent(this.oS3Instance.oPurchaseDetail);this.displayPurchasedata(r);}},this);},getSubrangeTemplate:function(m){var i=new sap.m.ColumnListItem({type:"Navigation",cells:[new sap.m.Text({text:{path:"SubrangeDesc",formatter:function(){var d=m.getProperty("SubrangeDesc",this.getBindingContext());if(d!=="|#-#|"&&d!=="|#|"){fcg.mdg.approvecrv2.util.Formatter.handleCellBoldingSubrange(this,m);return d;}else return"";}}}),new sap.m.Text({text:{path:"Plant",formatter:function(){var d=m.getProperty("Plant",this.getBindingContext());if(d!=="|#-#|"&&d!=="|#|"){fcg.mdg.approvecrv2.util.Formatter.handleCellBoldingSubrange(this,m);return d;}else return"";}}})]});return i;},getPartnerFuncTemplate:function(m){var t=this;var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"PARVW__TXT",formatter:function(){var d=m.getProperty("PARVW__TXT",this.getBindingContext());var k=m.getProperty("PARVW",this.getBindingContext());fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"PARVW");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}}}),new sap.m.Text({text:{path:"REFLEXIVE__TXT",formatter:function(){var d=m.getProperty("REFLEXIVE__TXT",this.getBindingContext());if(d!==""){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"REFLEXIVE");return d;}else{fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"REFLEXIVE");return t.getView().getModel("i18n").getProperty("PC_NO");}}}}),new sap.m.Text({text:{path:"LIFN2__TXT",formatter:function(){var d=m.getProperty("LIFN2__TXT",this.getBindingContext());var k=m.getProperty("LIFN2",this.getBindingContext());if(d!==""&&k!==""){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LIFN2");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}var K=m.getProperty("KUNN2__TXT",this.getBindingContext());var a=m.getProperty("KUNN2",this.getBindingContext());if((a!==""&&a!==undefined)&&K!==""){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"KUNN2");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(a,K);}var c=m.getProperty("PARNR__TXT",this.getBindingContext());var b=m.getProperty("PARNR",this.getBindingContext());if(c!==""&&(b!==""&&b!==undefined)){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"PARNR");return fcg.mdg.approvecrv2.util.Formatter.descriptionWithRemoveZeros(b,c);}var p=m.getProperty("PERNR__TXT",this.getBindingContext());var e=m.getProperty("PERNR",this.getBindingContext());if((e!==""&&e!==undefined)&&p!==""){e=fcg.mdg.approvecrv2.util.Formatter.removeLeadingZeros(e);fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"PERNR");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(e,p);}}}}),new sap.m.Text({text:{path:"DEFPA__TXT",formatter:function(){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"DEFPA");return m.getProperty("DEFPA__TXT",this.getBindingContext());}}}),new sap.m.Text({text:{path:"LTSNR__TXT",formatter:function(){var d=m.getProperty("LTSNR__TXT",this.getBindingContext());var k=m.getProperty("LTSNR",this.getBindingContext());if(k!=="|#-#|"&&k!=="|#|"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LTSNR");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}else if(d!=="|#-#|"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"LTSNR");return d;}else return"";}}}),new sap.m.Text({text:{path:"WERKS__TXT",formatter:function(){var d=m.getProperty("WERKS__TXT",this.getBindingContext());var k=m.getProperty("WERKS",this.getBindingContext());if(k!=="|#|"){fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"WERKS");return fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(k,d);}else{fcg.mdg.approvecrv2.util.Formatter.handleCellBolding(this,m,"WERKS");return d;}}}})]});return i;},navtoSubRangeDetail:function(e){this.bindingContext=e.getSource("listItem").getBindingContext();if(this.bindingContext!==undefined){this.sPath=e.getSource("listItem").getBindingContext().sPath;}else{this.bindingContext=e.getParameter("listItem").getBindingContext();this.sPath=e.getParameter("listItem").getBindingContext().sPath;}var p="";p=this.sPath.split("/");var a=this.bindingContext.oModel.oData.dataitems[p[2]];this.result=fcg.mdg.approvecrv2.DomainSpecParts.Supplier.getNavData();fcg.mdg.approvecrv2.DomainSpecParts.Supplier.setNavData(this.result);this.oRouter=fcg.mdg.approvecrv2.DomainSpecParts.Supplier.getRouter();this.changerequestId=fcg.mdg.approvecrv2.DomainSpecParts.Supplier.getchangeRequest();this.contextPath=fcg.mdg.approvecrv2.DomainSpecParts.Supplier.getContextPath();this.oRouter.navTo("SubRange",{ChangeRequestID:this.changerequestId,contextPath:this.contextPath,Key:a.Key});},displayPurchasedata:function(r){var e="";var m="";var a="";var k="";var b="";var d="";var C="";var c="";for(var i=0;i<r.results.length;i++){if(r.results.length>1){if(r.results[i].SP_AssignedSupplierRel!==undefined&&r.results[i].SP_AssignedSupplierRel.KTOKK!==undefined&&r.results[i].SP_AssignedSupplierRel.KTOKK__TXT!==undefined){c=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(r.results[i].SP_AssignedSupplierRel.KTOKK,r.results[i].SP_AssignedSupplierRel.KTOKK__TXT);}this.subheader=fcg.mdg.approvecrv2.DomainSpecParts.SupplierCreate.getSubheaderWithAccGrp(r.results[i].STANDARD,r.results[i].OBJECT_ID__TXT,r.results[i].REASON_ID__TXT,c);}else{this.subheader="";}for(var j=0;j<r.results[i].SP_AssignedPurchasingOrgsRel.results.length;j++){var A=r.results[i].SP_AssignedPurchasingOrgsRel.results[j];var f=A.ASSIGNMENT_ID+A.EKORG;if(f===this.CompCode){var p=this.getView().getModel("i18n").getProperty("SP_purchorg")+": "+A.EKORG__TXT+"("+A.EKORG+")";this.getView().byId("PurchaseObjHeaderDet").setTitle(p);var g=fcg.mdg.approvecrv2.util.DataAccess.getObjectKey();this.getView().byId("purchasebpdesc").setText(g);this.getView().byId("erpVendPurchase").setText(this.subheader);var F=r.results[i].SP_AssignedPurchasingOrgsRel.results[j];m=new sap.ui.model.json.JSONModel();m.setData(F);e=sap.ui.getCore().byId("SimpleFormPurchase");e.setModel(m);if(A.ChangeData.results!==undefined){if(A.ChangeData.results.length>0){var S="text_bold";for(var l=0;l<A.ChangeData.results.length;l++){var L="lblPur"+A.ChangeData.results[l].Attribute;var o=sap.ui.getCore().byId(L);if(o!==undefined){o.setDesign("Bold");}var t="pur"+A.ChangeData.results[l].Attribute;if(sap.ui.getCore().byId(t)!==undefined){sap.ui.getCore().byId(t).addStyleClass(S);}}}}fcg.mdg.approvecrv2.DomainSpecParts.Supplier.hidePurchaseSection();var E=sap.ui.getCore().byId("lblSuppPurchdEKORG");E.setVisible(false);var v=sap.ui.getCore().byId("lblSuppPurchdVendor");v.setVisible(false);var h=sap.ui.getCore().byId("SuppPurchdEKORG");h.setVisible(false);if(A.SP_PurchOrgPartnerFunctionsRel.results!==undefined&&A.SP_PurchOrgPartnerFunctionsRel.results.length>0){a=A.SP_PurchOrgPartnerFunctionsRel;m=new sap.ui.model.json.JSONModel();m.setData(a);e=sap.ui.getCore().byId("supppartnerfunc");e.setVisible(true);e.setModel(m);this.oItemTempPf=this.getPartnerFuncTemplate(m);e.bindItems("/results",this.oItemTempPf);}else{sap.ui.getCore().byId("supppartnerfunc").setVisible(false);}if(A.SP_PurchOrgPurchasingOrg2Rel.results!==undefined&&A.SP_PurchOrgPurchasingOrg2Rel.results.length>0){a={dataitems:[],ChangeData:[]};for(k=0;k<A.SP_PurchOrgPurchasingOrg2Rel.results.length;k++){var n=A.SP_PurchOrgPurchasingOrg2Rel.results[k];var q=n.WERKS;var u=n.WERKS__TXT;var w=n.LTSNR;var x="";var y=false;if(n.LTSNR!=='|#-#|'&&n.LTSNR!==''){x=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(n.LTSNR,n.LTSNR__TXT);}if(n.ChangeData!==undefined&&n.ChangeData.results!==undefined){for(var s=0;s<n.ChangeData.results.length;s++){if(n.ChangeData.results[s].EntityAction==="D"){y=true;}}}var z=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(q,u);b=n.ASSIGNMENT_ID;d={"SubrangeDesc":x,"Plant":z,"Key":b+n.EKORG+w+q,"SubrangeDeleted":y};a.dataitems.push(d);if(n.ChangeData.results!==undefined&&n.ChangeData.results.length>0){C={"changeId":b+n.EKORG+w+q};a.ChangeData.push(C);}}m=new sap.ui.model.json.JSONModel();m.setData(a);e=this.getView().byId("suppsubrangetable");e.setVisible(true);e.setModel(m);this.oSubrangeTemplate=this.getSubrangeTemplate(m);this.oSubrangeTemplate.attachPress({Entity:"SubRange",Key:a.dataitems,EntityData:r},this.navtoSubRangeDetail);e.bindItems("/dataitems",this.oSubrangeTemplate);e.setVisible(true);}else{this.getView().byId("suppsubrangetable").setVisible(false);}}}}}});
