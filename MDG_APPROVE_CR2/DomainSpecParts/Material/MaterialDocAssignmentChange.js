/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialDocAssignmentChange");jQuery.sap.require("fcg.mdg.approvecrv2.util.Formatter");jQuery.sap.require("fcg.mdg.approvecrv2.DomainSpecParts.Material.Material");jQuery.sap.require("fcg.mdg.approvecrv2.util.DataAccess");fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialDocAssignmentChange={oMaterialDocumentsTable:"",oMaterialDocTextTable:"",aDocumentsData:"",aDocTextData:"",nodata:"",oAttachment:"",vLinkPressed:"",oS3Controller:"",strDocuments:"",strDocText:"",oMaterialS4DocForm:"",oDocTableS4Details:"",vAdded:"",vNotMaint:"",vDeleted:"",aDocChangedData:"",vTxtAddedflag:0,i18n:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle(),initializeDocTables:function(d,s){this.oS3Controller=s;sap.ui.getCore().byId("matCreateDocAssignmentDataLayout").removeAllContent();sap.ui.getCore().byId("matChangeDocAssignmentDataLayout").removeAllContent();if(sap.ui.getCore().byId("matCreateDocAssignmentDataLayout")!==undefined){sap.ui.getCore().byId("matCreateDocAssignmentDataLayout").destroy();}this.aDocumentsData=d;this.oMaterialDocumentsTable=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.Material.MatChangeTableReuse',this);sap.ui.getCore().byId("matChangeDocAssignmentDataLayout").addContent(this.oMaterialDocumentsTable);this.oMaterialDocumentsTable.setGrowing(true);this.strDocuments=this.i18n.getText("Mat_Documents");fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.setHeaderToolbar(this.oMaterialDocumentsTable,this.i18n.getText("Mat_Documents"));this.oMaterialDocTextTable="";this.oMaterialDocTextTable=sap.ui.xmlfragment('fcg.mdg.approvecrv2.frag.Material.MatChangeTableReuse',this);sap.ui.getCore().byId("matChangeDocAssignmentDataLayout").addContent(this.oMaterialDocTextTable);this.oMaterialDocTextTable.setGrowing(true);this.strDocText=this.i18n.getText("Mat_Txt");fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.setHeaderToolbar(this.oMaterialDocTextTable,this.i18n.getText("Mat_Txt"));this.vAdded=this.i18n.getText("PC_ADDED");this.vNotMaint="("+this.i18n.getText("PC_NOT_MAIN")+")";this.vDeleted=this.i18n.getText("PC_DELETED");},displayTableData:function(v){this.bindDocumentsTextDataTable(v,this.aDocumentsData);},bindDocumentsTextDataTable:function(v){var d={EntityDesc:"",EntityName:"",AttributeDesc:"",NewValue:"",OldValue:"",NewValueText:"",OldValueText:"",DOKNR:"",DOKAR:"",DOKVR:"",DOKTL:"",DOKAR__TXT:"",LANGUCODE:"",LANGUCODE_TXT:"",TXTDRAD:""};this.workOnDocumentsData(d,v);d=[];this.workOnDocumentsTextData(d,v);},workOnDocumentsData:function(d,v){var s={dataitems:[]};var a="";var D;var b=this.aDocumentsData.__batchResponses[0].data.MATERIAL2DRADBASICRel;for(var i=0;i<b.results.length;i++){for(var j=0;j<b.results[i].ChangeData.results.length;j++){D=b.results[i].ChangeData.results[j];switch(D.EntityAction){case fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.vNewEntity:{d.NewValue=this.vAdded;d.OldValue="";d.AttributeDesc="";d.DOKNR=b.results[i].DOKNR;d.DOKAR=b.results[i].DOKAR;d.DOKAR__TXT=b.results[i].DOKAR__TXT;d.DOKTL=b.results[i].DOKTL;d.DOKVR=b.results[i].DOKVR;a=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(b.results[i].DOKAR,b.results[i].DOKAR__TXT);d.EntityDesc=a+"/"+b.results[i].DOKNR+"/"+b.results[i].DOKVR+"/"+b.results[i].DOKTL;d.EntityName=this.i18n.getText("Mat_Doc_key");s.dataitems.push(d);d=[];break;}case fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.vDeletedEntity:{d.NewValue=this.vDeleted;d.OldValue="";d.AttributeDesc="";d.DOKNR=b.results[i].DOKNR;d.DOKAR=b.results[i].DOKAR;d.DOKAR__TXT=b.results[i].DOKAR__TXT;d.DOKTL=b.results[i].DOKTL;d.DOKVR=b.results[i].DOKVR;a=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(b.results[i].DOKAR,b.results[i].DOKAR__TXT);d.EntityDesc=a+"/"+b.results[i].DOKNR+"/"+b.results[i].DOKVR+"/"+b.results[i].DOKTL;d.EntityName=this.i18n.getText("Mat_Doc_key");s.dataitems.push(d);d=[];break;}}break;}}this.aDocChangedData=s;this.bindDocumentsData(s,v);},getDocAssignmentData:function(){return this.aDocChangedData;},bindDocumentsData:function(d,v){if(d.dataitems.length===0){if(this.oMaterialDocumentsTable!==undefined){this.oMaterialDocumentsTable.destroy();}}else{var i=this.createTableTemplate();var D=new sap.ui.model.json.JSONModel();D.setData(d);this.oMaterialDocumentsTable.setModel(D);i.attachPress({name:'matDocAssignmentChangeDataDetail'},v.navtoSubDetail,v);this.oMaterialDocumentsTable.bindItems('/dataitems',i,'','');}},bindDocTextData:function(t,v){if(t.results.length===0){if(this.oMaterialDocTextTable!==undefined){this.oMaterialDocTextTable.destroy();}}else{var i=this.createTableTemplate();i.attachPress({Entity:this.oMaterialDocTextTable,name:'matDocAssignmentChangeTextDataDetail'},v.navtoSubDetail,v);var d=new sap.ui.model.json.JSONModel();d.setData(t);this.oMaterialDocTextTable.setModel(d);this.oMaterialDocTextTable.bindItems('/results',i,'','');}if(t.results.length===0&&this.aDocChangedData.dataitems.length===0){sap.ui.getCore().byId("matChangeDocAssignmentDataLayout").removeAllContent();var n=this.i18n.getText("NodataChanged");var D=sap.ui.getCore().byId("matChangeDocAssignmentDataLayout");fcg.mdg.approvecrv2.DomainSpecParts.Material.MaterialCreate.setNoDataText(D,n);}},workOnDocumentsTextData:function(d,v){var s={results:[]};var a={results:[]};var A;var e,n,o,l,D,b;var c=this.aDocumentsData.__batchResponses[0].data.MATERIAL2DRADBASICRel;for(var i=0;i<c.results.length;i++){for(var j=0;j<c.results[i].DRADBASIC2DRADTXTRel.results.length;j++){for(var k=0;k<c.results[i].DRADBASIC2DRADTXTRel.results[j].ChangeData.results.length;k++){b=c.results[i].DRADBASIC2DRADTXTRel.results[j];A=b.ChangeData.results[k].Attribute;e=b.ChangeData.results[k].EntityAction;n=b.ChangeData.results[k].NewValue;o=b.ChangeData.results[k].OldValue;l=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(b.LANGUCODE,b.LANGUCODE__TXT);D=fcg.mdg.approvecrv2.util.Formatter.getKeyDesc(b.DOKAR,b.DOKAR__TXT);if(A==='TXTDRAD'){if(e===fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getUpdateEntityAction()){n=fcg.mdg.approvecrv2.util.Formatter.Truncate(n);o=fcg.mdg.approvecrv2.util.Formatter.Truncate(o);d.NewValue=n;d.OldValue=o;}if(e===fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getCreateEntityAction()){d.NewValue=this.vAdded;d.OldValue="";d.AttributeDesc="";}if(e===fcg.mdg.approvecrv2.DomainSpecParts.Material.Material.getDeleteEntityAction()){d.NewValue=this.vDeleted;o=fcg.mdg.approvecrv2.util.Formatter.Truncate(o);d.OldValue=o;d.AttributeDesc="";}d.DOKAR=b.DOKAR;d.DOKAR__TXT=b.DOKAR__TXT;d.DOKNR=b.DOKNR;d.DOKVR=b.DOKVR;d.DOKTL=b.DOKTL;d.TXTDRAD=b.TXTDRAD;d.LANGUCODE=b.LANGUCODE;d.LANGUCODE__TXT=b.LANGUCODE__TXT;d.EntityDesc=l+", "+D+"/"+d.DOKNR+"/"+d.DOKVR+"/"+d.DOKTL;d.EntityName=this.i18n.getText("Language")+", "+this.i18n.getText("Mat_Doc_key");}}a.results.push(d);d=[];}}for(var i=0;i<a.results.length;i++){for(var j=0;j<this.aDocChangedData.dataitems.length;j++){if(a.results[i].DOKAR===this.aDocChangedData.dataitems[j].DOKAR&&a.results[i].DOKNR===this.aDocChangedData.dataitems[j].DOKNR&&a.results[i].DOKTL===this.aDocChangedData.dataitems[j].DOKTL&&a.results[i].DOKVR===this.aDocChangedData.dataitems[j].DOKVR){this.vTxtAddedflag=1;}}if(this.vTxtAddedflag===0&&a.results[i].LANGUCODE!==undefined){s.results.push(a.results[i]);}this.vTxtAddedflag=0;}this.aDocTextData=s;this.bindDocTextData(s,v);},getTextDetailData:function(){return this.aDocTextData;},createTableTemplate:function(){var i=new sap.m.ColumnListItem({type:"Navigation",cells:[new sap.m.ObjectIdentifier({text:{path:"EntityName"},title:{path:"EntityDesc"}}).addStyleClass("text_bold"),new sap.m.ObjectIdentifier({text:{path:"AttributeDesc"},title:{path:"NewValue"}}),new sap.m.Text({text:{path:"OldValue"}})]});var e=this.oS3Controller.matHookcreateTableTemplate(i);if(e!==undefined){i=e;}return i;}};
